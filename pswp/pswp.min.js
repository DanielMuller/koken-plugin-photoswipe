var initPhotoSwipeFromDOM=function(options){var parseThumbnailElements=function(e){var t=[];return e.children("img").each(function(){typeof $(this).attr("data-base")!="undefined"&&typeof $(this).attr("data-extension")!="undefined"&&typeof $(this).attr("data-presets")!="undefined"&&(item={},base=$(this).attr("data-base"),ext=$(this).attr("data-extension"),item._common={msrc:$(this).attr("data-src")||$(this).attr("src")},jQuery.each($(this).attr("data-presets").split(" "),function(e,t){preset_info=t.split(","),name=preset_info[0],size_factor=isHighDensity()?2:1,retina=isHighDensity()?".2x.":".",w=parseInt(preset_info[1]),h=parseInt(preset_info[2]),src=base+name+retina+ext,item[name]={src:src,w:size_factor*w,h:size_factor*h}}),t.push(item))}),t},photoswipeParseHash=function(){var e=window.location.hash.substring(1),t={};if(e.length<5)return t;var n=e.split("&");for(var r=0;r<n.length;r++){if(!n[r])continue;var i=n[r].split("=");if(i.length<2)continue;t[i[0]]=i[1]}return t.gid&&(t.gid=parseInt(t.gid,10)),t.hasOwnProperty("pid")?(t.pid=parseInt(t.pid,10),t):t},openPhotoSwipe=function(index,disableAnimation){var pswpElement=$(".pswp")[0],gallery,options,items;if(pswp_open)return!0;items=parseThumbnailElements(galleryElements),availableShareButtons={facebook:{id:"facebook",label:"Share on Facebook",url:"https://www.facebook.com/sharer/sharer.php?u={{url}}"},twitter:{id:"twitter",label:"Tweet",url:"https://twitter.com/intent/tweet?text={{text}}&url={{url}}"},pinterest:{id:"pinterest",label:"Pin it",url:"http://www.pinterest.com/pin/create/button/?url={{url}}&media={{image_url}}&description={{text}}"},gplus:{id:"gplus",label:"Google+",url:"https://plus.google.com/share?url={{url}}"},tumblr:{id:"tumblr",label:"Tumblr",url:"http://www.tumblr.com/share/photo?caption={{text}}&click_thru={{url}}&source={{image_url}}"},download:{id:"download",label:"Download Image",url:"",download:!0}};var shareButtons=Array();$.each(koken_options.sharing,function(index,value){shareButtons.push(eval("availableShareButtons."+value))}),options={index:parseInt(index),preload:[5,5],getThumbBoundsFn:function(e){return el=$("[data-pswp-gid='"+e+"']").children("img[data-presets]"),{x:el.offset().left,y:el.offset().top,w:el.width()}},shareButtons:shareButtons,shareEl:shareButtons.length>0,getDoubleTapZoom:function(){return window.devicePixelRatio>1?.5:1}},disableAnimation&&(options.showAnimationDuration=0),gallery=new PhotoSwipe(pswpElement,PhotoSwipeUI_Default,items,options);var realViewportWidth,useImageSize="medium_large",firstResize=!0,imageSrcWillChange;gallery.listen("beforeResize",function(){size_factor=isHighDensity()?2:1,realViewportWidth=gallery.viewportSize.x*size_factor,useImageSize!="huge"&&realViewportWidth>=1600&&"huge"in items[0]?(useImageSize="huge",imageSrcWillChange=!0):useImageSize!="xlarge"&&realViewportWidth>=1024&&"xlarge"in items[0]?(useImageSize="xlarge",imageSrcWillChange=!0):useImageSize!="large"&&realViewportWidth>=800&&"large"in items[0]?(useImageSize="large",imageSrcWillChange=!0):useImageSize!="medium_large"&&(useImageSize="medium_large",imageSrcWillChange=!0),imageSrcWillChange&&!firstResize&&gallery.invalidateCurrItems(),firstResize&&(firstResize=!1),imageSrcWillChange=!1}),gallery.listen("gettingData",function(e,t){t.src=t[useImageSize].src,t.msrc=t._common.msrc,t.w=t[useImageSize].w,t.h=t[useImageSize].h});var scroll_move=null;typeof $K=="object"&&typeof $K.keyboard=="object"&&typeof $K.keyboard.scroll=="object"&&typeof $K.keyboard.scroll.move=="function"&&(scroll_move=$K.keyboard.scroll.move,$K.keyboard.scroll.move=function(){return!0}),gallery.listen("destroy",function(){scroll_move&&($K.keyboard.scroll.move=scroll_move,scroll_move=null),pswp_open=!1,$(".pswp")[0].className="pswp",pswp_open_orientation!=window.orientation&&initPS()}),gallery.init(),pswp_open=!0,pswp_open_orientation=window.orientation},isHighDensity=function(){return window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 144dpi), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 48.8dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (min-device-pixel-ratio: 1.3)").matches)||window.devicePixelRatio&&window.devicePixelRatio>1.3},initPS=function(){koken_options.usingPillar?setTimeout(runInitPS,500):runInitPS()},runInitPS=function(){pswp_open||($(".pswp")[0].className="pswp",$("a[data-pswp-gid]").removeAttr("data-pswp-gid"));var e=0;koken_options.usingPillar?(size_group=="size_0"&&typeof start_size_group=="undefined"&&(old_size_group=size_group,class_attr=$("div.pillar").attr("class"),class_attr&&(start_size_group=$.grep(class_attr.split(" "),function(e){return e!="pillar"})[0])),orientation_changed&&(size_group=="size_0"&&(size_group=start_size_group),old_size_group=size_group,class_attr=$("div.pillar:not(."+old_size_group+")").attr("class"),class_attr&&(size_group=$.grep(class_attr.split(" "),function(e){return e!="pillar"})[0]),orientation_changed=!1),galleryElements=$("div.pillar:not(."+old_size_group+") "+koken_options.triggerEl)):galleryElements=$(koken_options.triggerEl),pswp_open||galleryElements.each(function(){$(this).children("img").length>0&&!$(this).parent().hasClass('type_video')&&($(this).click(function(e){return openPhotoSwipe(parseInt($(this).first().attr("data-pswp-gid"))),!1}),$(this).attr("data-pswp-gid",e),e++)})},koken_options=options,pswp_open=!1,pswp_open_orientation,orientation_changed=!1,orientation=window.orientation,size_group="size_0",old_size_group,start_size_group,galleryElements=$(koken_options.triggerEl);koken_options.usingPillar?($(document).on("pjax:end",function(){initPS()}),$(window).on("orientationchange",function(){window.orientation!=orientation?(orientation_changed=!0,orientation=window.orientation,initPS()):orientation_changed=!1}),$(window).on("k-infinite-loaded",function(){initPS()}),initPS()):initPS();var hashData=photoswipeParseHash();hashData.pid>0&&openPhotoSwipe(hashData.pid-1,!0)};
